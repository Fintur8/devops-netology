# Домашнее задание к занятию "4.1. Командная оболочка Bash: Практические навыки"

# 1)    Есть скрипт:

    a=1
    b=2
    c=a+b
    d=$a+$b
    e=$(($a+$b))

        Какие значения переменным c,d,e будут присвоены?
        Почему?

    Ответ:

    c = "a+b" - имеет место неявное определение целочисленного и поэтому bash воспринимает это как строку.
    b = "1+3" - при подстановке символа $ происходит подстановка ранее заданных переменных a и b, но так как имеет место неявное определение целочисленного и поэтому bash снова воспринимает это как строку.
    e = "3"   - При использовании операций вида e=$(($a+$b)) Bash понимает, что это стандартные операции с целыми числами ( за счёт ввода "скобок" и символа $)  и выполняет их сложение.

# 2) Обязательная задача 2
На нашем локальном сервере упал сервис и мы написали скрипт, который постоянно проверяет его доступность, записывая дату проверок до тех пор, пока сервис не станет доступным (после чего скрипт должен завершиться). 
В скрипте допущена ошибка, из-за которой выполнение не может завершиться, при этом место на Жёстком Диске постоянно уменьшается. Что необходимо сделать, чтобы его исправить:

while ((1==1)
do
	curl https://localhost:4757
	if (($? != 0))
	then
		date >> curl.log
	fi
done

    1. в начале цикла не хватает закрывающей скобки 
    2. для уменьшения количества места, потребляемого скриптом можно задать интервал проверки через sleep.
    3. для завершения выполнения скрипта нужно добавить в условие else exit чтобы выйти из цикла .
      
        while (( 1 == 1 ))
    do
        curl https://localhost:4757
        if (($? != 0))
        then
            date >> curl.log
        else exit
        fi
        sleep 10
    done


# 2.1) Необходимо написать скрипт, который проверяет доступность трёх IP: 192.168.0.1, 173.194.222.113, 87.250.250.242 по 80 порту и записывает результат в файл log. Проверять доступность необходимо пять раз для каждого узла.

	Ваш скрипт:
		#!/usr/bin/bash
		PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/bin
		array_ip=(nginx.vagrant.local 192.168.45 10.1.2.4)
		timeout=5
		for i in {1..5}
		do
		date >>log_curl.log
			for h in ${array_ip[@]}
			do
				curl -Is --connect-timeout $timeout $h:80 >/dev/null
				echo "  Проверка выполнена:" $h status=$? >>log_curl.log
			done
		done

# 3) Обязательная задача 3
Необходимо дописать скрипт из предыдущего задания так, чтобы он выполнялся до тех пор, пока один из узлов не окажется недоступным. Если любой из узлов недоступен - IP этого узла пишется в файл error, скрипт прерывается.

	Ваш скрипт:

	#!/usr/bin/bash
	PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/bin
	array_ip=(nginx.vagrant.local)
	timeout=5
	rs=0
	while (($rs == 0))
	do
	date >>log_curl.log
		for h in ${array_ip[@]}
		do
			curl -Is --connect-timeout $timeout $h:80 >/dev/null
			rs=$?
			if (($rs != 0))
			then
					echo "  Проверка выполнена, проблема с хостом :" $h status=$rs >>log_eror.log
					exit
			fi
		done
	done
